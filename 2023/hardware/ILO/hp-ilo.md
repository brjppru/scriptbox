# hp ilo #

Previous Share  Next
Немного про HP-шные сервера и iLO-шки
Уж не знаю, с какого перепугу HP в некоторых серверах стала заменять старые добрые iLO2 на мерзопакостнейшие LO100. То ли они ставят эти LO100 в бюджетные серваки, то ли ещё чего. Уж не знаю. Но гадость эта редкостная.

На случай, если вам вдруг попадётся такая же дрянь, выкладываю краткий cookbook и список граблей, которые там в обилии закопаны. Здесь и далее речь идёт о HP LO100.

Ребутнуть собственно BMC (Baseboard management controller) из веб-интерфейса нельзя. Для этого обязательно придется воспользоваться CLI-интерфейсом (telnet либо SSH). Команды:
cd /map1
reset
Иногда (и очень часто) оно подвисает. Причём с весьма странными симптомами. Например, через CLI пользователь успешно заходит, а веб-интерфейс даёт отлуп типа "неверный логин-пароль". Перезагрузка BMC помогает.
Обновить Firmware удалённо можно только посредством TFTP. Загрузить через Virtual Media Applet образ CD с прошивкой не удастся: он в процессе диагностики перезапустит BMC и всё отвалится. Прежде чем загружать на TFTP-сервер бинарник с новой прошивкой, скачанный с офсайта HP, его сперва надо (внезапно) распаковать командой вида "ROMPAQ.EXE /D CPQQ1402.AA8 ilo.bin". Разумеется, в readme-шках этого не написано.
Апплет Virtual Media не работает через NAT. То есть если у LO-шки честный IP, то работать (в плане Virtual Media) с ней можно будет только также с честного IP. При этом оно, разумеется, никоим образом вам не даст понять чего именно ей не хватает. С точки зрения пользователя ничто не вызывает подозрений. Только не работает. Понять же, хорошо идут дела или плохо можно только после нажатия на кнопку "Connect". Если первый скриншот превратится во второй (кликабельно), то всё в порядке. Если останется как было — всё плохо. Особое внимание обратите на содержимое колонки "Path". Повторяю, ошибки никакой он не выдаст. И не выматерится. Вот иди и разбирайся что же ему не понравилось...
 → 
Оно работает не со всеми версиями Java-машины. На JRE 7 update 51 валится с ошибкой. На 45-м ещё хоть как-то заводится.
Если в ведении админа находится несколько таких серверов, то по умолчанию в LO-шках будет один и тот же сертификат. Рано или поздно браузеры начнут материться на тему "опасносте, другой хост предложил такой же сертификат с таким же серийным номером" и не будут пускать на некоторые из них. Хочется установить свой собственный сертификат? Будьте внимательны. Оно понимает только самоподписанные DSA-сертификаты с длиной ключа 1024 бита. Ни больше и не меньше. Причем, если загрузить какой-нибудь "неправильный" сертификат, то до перезагрузки BMC мы никакой ошибки не увидим, а после — она уже не впустит нас ни на HTTPS, ни на SSH. Исправить ситуацию потом можно будет только через telnet (если оный сервис конечно включен в настройках).
Примеры команд для генерирования "правильных" сертификатов:
openssl dsaparam -out server_dsaparam.pem 1024
openssl gendsa -out server_privkey.pem server_dsaparam.pem
openssl req -new -x509 -key server_privkey.pem -out server_cacert.pem -days 1095
В-общем, чувствуете каково это — приобретать бюджетные сервачки?

И немного про обновление прошивки для дискового контроллера SmartArray P4**. Если у вас, как и у меня, Debian GNU/Linux amd64, то для того, чтобы их бинарник-прошивальщик имени "ccissflash" запустился, надо чтобы в системе были обязательно установлены следующие пакеты:

zsh
gawk
libc6-i386
lib32stdc++6
И в скачанном с офсайта скрипте-обновляторе первую строчку (sha-bang) надо заменить с "#!/bin/sh" на "#!/bin/zsh".

Не забудьте также, что при любых обновлениях FirmWare, сервачок нужно обязательно гасить. Не ребутать, а именно гасить, а потом включать обратно. Это важно. Исключение составляет сама LO-шка, которую можно и нужно ребутать. По любому поводу.

P.S. Начал ненавидеть и HP тоже.

https://klink0v.livejournal.com/162914.html

